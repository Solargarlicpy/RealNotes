<UserControl x:Class="RealNotes.DraggableNote"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             MinWidth="60" MinHeight="40"
             Focusable="True"
             UseLayoutRounding="True">
    <Border x:Name="OuterBorder" BorderThickness="1" BorderBrush="Gray" CornerRadius="4" Background="Transparent">
        <Grid>
            <TextBox x:Name="InnerTextBox"
                     Margin="2"
                     Background="{Binding NoteBackground, RelativeSource={RelativeSource AncestorType=UserControl}}"
                     Text="{Binding NoteText, RelativeSource={RelativeSource AncestorType=UserControl}, Mode=TwoWay}"
                     TextWrapping="Wrap"
                     AcceptsReturn="True"
                     VerticalScrollBarVisibility="Auto"/>
            <!-- Drag handle using a thumb control - user clicks and drags this to move the note -->
            <Thumb x:Name="DragThumb"
                   Width="13" Height="12"
                   HorizontalAlignment="Left" VerticalAlignment="Top"
                   Margin="-1,-1,0,0"
                   Cursor="SizeAll" DragDelta="DragThumb_DragDelta_1"
                   SnapsToDevicePixels="True">
                <!-- Style: hide by default (opacity0) but keep it hit-testable so users can hover and drag; reveal on mouse-over -->
                <Thumb.Style>
                    <Style TargetType="Thumb">
                        <Setter Property="Opacity" Value="0" />
                        <Setter Property="IsHitTestVisible" Value="True" />
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="1" />
                            </Trigger>
                            <!-- Also make visible when keyboard focus is on the thumb to aid accessibility -->
                            <Trigger Property="IsKeyboardFocusWithin" Value="True">
                                <Setter Property="Opacity" Value="1" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Thumb.Style>

                <Thumb.Template>
                    <!-- This is for the visual appearance of the drag thumb -->
                    <ControlTemplate TargetType="Thumb">
                        <Border Background="#DDDDDD" CornerRadius="2" BorderBrush="Gray" BorderThickness="1">
                            <TextBlock Text="⋮" FontSize="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Thumb.Template>
            </Thumb>

            <!-- Bottom right resize thumb -->
            <Thumb x:Name="ResizeThumb" Width="11" Height="12" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,-1,-1"
                   Cursor="SizeNWSE" DragDelta="ResizeThumb_DragDelta_1"
                   SnapsToDevicePixels="True">
                <!-- Hide by default but keep interactive; reveal on hover or keyboard focus -->
                <Thumb.Style>
                    <Style TargetType="Thumb">
                        <Setter Property="Opacity" Value="0" />
                        <Setter Property="IsHitTestVisible" Value="True" />
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="1" />
                            </Trigger>
                            <Trigger Property="IsKeyboardFocusWithin" Value="True">
                                <Setter Property="Opacity" Value="1" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Thumb.Style>
            </Thumb>
        </Grid>
    </Border>
</UserControl>
